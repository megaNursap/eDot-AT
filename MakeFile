VENV := .venv
PYTHON := $(VENV)/bin/python3

ANDROID_HOME ?= $(HOME)/Library/Android/sdk
ANDROID_SDK_ROOT ?= $(ANDROID_HOME)

export ANDROID_HOME
export ANDROID_SDK_ROOT
export PATH := $(ANDROID_HOME)/emulator:$(ANDROID_HOME)/platform-tools:$(PATH)


install: venv install-requirements

venv:
	@echo "ðŸ”¹ Creating virtual environment..."
	@test -d $(VENV) || python3 -m venv $(VENV)

install-requirements:
	@echo "ðŸ”¹ Installing Python dependencies..."
	$(PYTHON) -m pip install --upgrade pip
	$(PYTHON) -m pip install -r requirements.txt
	@echo "âœ… All dependencies are installed."

test:
	@echo "ðŸ”¹ Running pytest..."
	$(PYTHON) -m pytest -v -s
	@echo "âœ… Tests completed."

test-file:
	@echo "ðŸ”¹ Running pytest for file: $(FILE)..."
	$(PYTHON) -m pytest -v -s $(FILE)
	@echo "âœ… Tests completed."

.PHONY: allure-report

allure-report:
	@echo "ðŸ§¹ Cleaning old allure results..."
	rm -rf allure-results allure-report
	@echo "ðŸ”¹ Running pytest with Allure..."
	$(PYTHON) -m pytest $(FILE) --alluredir=allure-results
	@echo "ðŸ”¹ Generating Allure report..."
	allure generate allure-results -o allure-report --clean
	@echo "ðŸ”¹ Opening Allure report..."
	allure open allure-report